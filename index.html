<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Formal de Derivadas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.7.0/math.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="max-w-4xl mx-auto p-6">
        <div class="bg-white rounded-xl shadow-xl p-8 mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b-2 border-blue-200 pb-4">Calculadora Formal de Derivadas</h1>
            
            <div class="grid gap-6 mb-8">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Función matemática:</label>
                        <input type="text" id="funcion" 
                                class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="Ej: 3x^2 + cos(2x) - e^x">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Variable de derivación:</label>
                        <input type="text" id="variable" value="x" 
                                class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>

            <button onclick="calcularDerivada()" 
                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors flex items-center mb-8">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                </svg>
                Calcular Derivada Formal
            </button>

            <div id="resultados" class="space-y-6">
                <div id="pasos-formales" class="hidden bg-gray-50 p-6 rounded-xl">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                        <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2">1</span>
                        Proceso Formal por Límites
                    </h3>
                    <div class="text-gray-700 space-y-4">
                        <div id="sustitucion" class="paso-detalle"></div>
                        <div id="simplificacion" class="paso-detalle"></div>
                        <div id="limite-final" class="paso-detalle"></div>
                    </div>
                </div>

                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Gráfica de función y derivada</h3>
                    <canvas id="grafica" width="700" height="400" class="border rounded-lg"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        function calcularDerivada() {
            try {
                const funcion = document.getElementById('funcion').value;
                const variable = document.getElementById('variable').value;
                const parser = math.parse(funcion);
                
                document.getElementById('pasos-formales').classList.remove('hidden');

                // Proceso formal algebraico
                const f_x = parser.toString();
                const f_xh = parser.toString().replace(new RegExp(variable, 'g'), `(${variable}+h)`);
                const diferencia = math.simplify(`(${f_xh}) - (${f_x})`).toString();
                const expandido = math.expand(diferencia).toString();
                const dividido = math.simplify(`(${expandido})/h`).toString();
                const simplificado = math.simplify(dividido).toString();
                const limite = simplificado.replace(/h/g, '0');

                document.getElementById('sustitucion').innerHTML = `
                    <div>
                        <p class="text-sm font-medium text-blue-600">Paso 1: Función Original</p>
                        <p class="mt-1">\\[ f(${variable}) = ${f_x} \\]</p>
                        
                        <p class="text-sm font-medium text-blue-600 mt-4">Paso 2: Definición Formal</p>
                        <p class="mt-1">\\[ f'(${variable}) = \\lim_{h \\to 0} \\frac{f(${variable} + h) - f(${variable})}{h} \\]</p>
                        
                        <p class="text-sm font-medium text-blue-600 mt-4">Paso 3: Calcular f(${variable} + h)</p>
                        <p class="mt-1">\\[ f(${variable} + h) = ${f_xh} \\]</p>
                        
                        <p class="text-sm font-medium text-blue-600 mt-4">Paso 4: Diferencia f(${variable} + h) - f(${variable})</p>
                        <p class="mt-1">\\[ ${f_xh} - ${f_x} = ${diferencia} \\]</p>
                    </div>
                `;

                document.getElementById('simplificacion').innerHTML = `
                    <div>
                        <p class="text-sm font-medium text-blue-600">Paso 5: Expandir la Diferencia</p>
                        <p class="mt-1">\\[ ${expandido} \\]</p>
                        
                        <p class="text-sm font-medium text-blue-600 mt-4">Paso 6: Dividir por h</p>
                        <p class="mt-1">\\[ \\frac{${expandido}}{h} = ${dividido} \\]</p>
                        
                        <p class="text-sm font-medium text-blue-600 mt-4">Paso 7: Simplificar</p>
                        <p class="mt-1">\\[ ${simplificado} \\]</p>
                    </div>
                `;

                document.getElementById('limite-final').innerHTML = `
                    <div>
                        <p class="text-sm font-medium text-blue-600">Paso 8: Aplicar Límite</p>
                        <p class="mt-1">\\[ \\lim_{h \\to 0} (${simplificado}) = ${limite} \\]</p>
                    </div>
                `;

                graficarFuncionYDerivada(funcion, variable);
                MathJax.typeset();
            } catch (error) {
                alert(`Error: ${error.toString().replace('Error: ', '')}`);
            }
        }

        function graficarFuncionYDerivada(funcionStr, variableStr) {
            const canvas = document.getElementById('grafica');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const f = math.compile(funcionStr);
            const derivada = math.derivative(funcionStr, variableStr).compile();

            const xs = Array.from({length: 100}, (_, i) => -5 + (i * 0.1));
            const ysFunc = xs.map(x => f.evaluate({[variableStr]: x}));
            const ysDer = xs.map(x => derivada.evaluate({[variableStr]: x}));

            const yMin = Math.min(...ysFunc, ...ysDer);
            const yMax = Math.max(...ysFunc, ...ysDer);

            ctx.strokeStyle = '#333';
            ctx.beginPath();
            ctx.moveTo(50, 200);
            ctx.lineTo(650, 200);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(350, 50);
            ctx.lineTo(350, 350);
            ctx.stroke();

            // Graficar función
            ctx.strokeStyle = 'blue';
            ctx.beginPath();
            xs.forEach((x, i) => {
                const px = 350 + (x * 60);
                const py = 200 - (ysFunc[i] * 30);
                ctx.lineTo(px, py);
            });
            ctx.stroke();

            // Graficar derivada
            ctx.strokeStyle = 'red';
            ctx.beginPath();
            xs.forEach((x, i) => {
                const px = 350 + (x * 60);
                const py = 200 - (ysDer[i] * 30);
                ctx.lineTo(px, py);
            });
            ctx.stroke();
        }
    </script>
</body>
</html>
