<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Cabecera existente sin cambios -->
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script> <!-- Añadido -->
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- Contenido existente sin cambios hasta la sección de resultados -->
    
    <div id="resultados" class="space-y-6">
        <!-- Secciones existentes... -->
        
        <!-- Nueva sección de gráfico -->
        <div id="grafico-container" class="hidden bg-gray-50 p-6 rounded-xl">
            <h3 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                <span class="bg-purple-600 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2">3</span>
                Visualización Gráfica
            </h3>
            <div id="grafico" class="h-64"></div>
        </div>
    </div>

    <script>
        function actualizarGrafico(funcion, variable) {
            try {
                const xValues = Array.from({length: 100}, (_, i) => -5 + (i * 0.1));
                const yOriginal = xValues.map(x => math.evaluate(funcion, {[variable]: x}));
                const yDerivada = xValues.map(x => math.derivative(funcion, variable).evaluate({[variable]: x}));

                Plotly.newPlot('grafico', [{
                    x: xValues,
                    y: yOriginal,
                    name: 'Función Original',
                    line: {color: '#3B82F6'}
                }, {
                    x: xValues,
                    y: yDerivada,
                    name: 'Derivada',
                    line: {color: '#10B981', dash: 'dot'}
                }], {
                    margin: {t: 30, l: 50, r: 30, b: 40},
                    paper_bgcolor: '#f9fafb',
                    plot_bgcolor: '#f9fafb',
                    xaxis: {title: variable, gridcolor: '#e5e7eb'},
                    yaxis: {title: 'Valor', gridcolor: '#e5e7eb'}
                });
                
                document.getElementById('grafico-container').classList.remove('hidden');
            } catch (error) {
                console.error('Error al generar gráfico:', error);
            }
        }

        function calcularDerivada(tipo) {
            try {
                // Cálculos existentes sin cambios...
                
                // Llamada al gráfico después de los cálculos
                const funcion = document.getElementById('funcion').value;
                const variable = document.getElementById('variable').value;
                actualizarGrafico(funcion, variable);

            } catch (error) {
                alert(`Error: ${error.toString().replace('Error: ', '')}`);
            }
        }
    </script>
</body>
</html>
